// visualise.js
'use strict';

$(document).ready(function() {
    $(document).scrollsnap({
        snaps: '.sticky',
        proximity: 200
    });
});

// ********************** D3 Visualisations **********************

var data = d3.csv("http://127.0.0.1:3000/gpx_out.csv",function(csv) {

var latitude = [];
var longitude = [];
var dataOut = [];

for (var i = 0; i < csv.length; i++) {
    latitude[i] = Number(csv[i].latitude)
    longitude[i] = Number(csv[i].longitude)
    dataOut[i] = [latitude[i], longitude[i]]
}

var width = Math.max(760, window.innerWidth),
    height = Math.max(500, window.innerHeight);

var tiler = d3.geo.tile()
    .size([width, height]);

var projection = d3.geo.mercator()
    .center([-2.6, 51.5])
    .scale((1 << 20) / 2 / Math.PI)
    .translate([width / 2, height / 2]);

var geoJSON = {
    "type": "FeatureCollection",
    "features":[
        {
            "type":"Feature",
            "geometry":{
                "type":"LineString",
                "coordinates": dataOut
            },
            "properties":{
            }
        }
    ]
}

var geoJSON2 = {"type":"FeatureCollection","features":[[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}]]}
var geoJSON3 = {"type":"FeatureCollection","features":[[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.6131665559,51.4794909109],[-2.6128884858,51.4680175502],[-2.6128714612,51.468007338],[-2.6124981271,51.4676642393],[-2.6109187427,51.4659501851],[-2.6099340114,51.4648758562],[-2.6094075783,51.4640840263],[-2.6094101611,51.464068969],[-2.6094177894,51.4640486994],[-2.6094320521,51.4640220783],[-2.6094361164,51.4639543026],[-2.6094162321,51.4638832255],[-2.6089670944,51.463051951],[-2.6084783377,51.4615929772],[-2.6084292617,51.4610944706],[-2.608441265,51.4610336525],[-2.6084273917,51.4610083636],[-2.6084183381,51.4609530707],[-2.6086328681,51.4599466023],[-2.6087723539,51.4585382287],[-2.6085788808,51.4576725275],[-2.6067829,51.4566138195],[-2.6067483551,51.4565995621],[-2.6067467084,51.4566040893],[-2.6067102069,51.4565923867],[-2.6051692118,51.4560133581],[-2.605168532,51.4560131026],[-2.6051466913,51.456004896],[-2.6049230676,51.455997123],[-2.6038411261,51.4554536804],[-2.6018869866,51.4539046787],[-2.6013023506,51.4534429941],[-2.6012040785,51.4533551658],[-2.6011130283,51.4532784804],[-2.5986252337,51.4523614551],[-2.5979415465,51.4530655281],[-2.5979137345,51.4532064959],[-2.5978850741,51.4532685713],[-2.5978363077,51.4535442351],[-2.5978243982,51.4535643559],[-2.5977879154,51.4536121306],[-2.5977402884,51.4536623409],[-2.5976976253,51.4537155313],[-2.5972118502,51.4544826048],[-2.5959952126,51.4553922324],[-2.5939318918,51.4565165489],[-2.5934811893,51.4565786042],[-2.5933575105,51.45659329],[-2.5915250624,51.4570254969],[-2.5914152891,51.4579898169],[-2.5911459808,51.4580659754],[-2.5902682539,51.4583864441],[-2.5891568871,51.4587652352],[-2.5878501143,51.4588353972],[-2.586312204,51.4577093941],[-2.586088806,51.4573522156],[-2.5860518285,51.4572931453],[-2.5860047254,51.4572159881],[-2.5867935082,51.4567519198],[-2.5874930441,51.4565306475],[-2.5889453209,51.4561372339],[-2.5906388888,51.4556713211],[-2.5913051186,51.4554825762],[-2.5913389228,51.4554727344],[-2.5922896764,51.4543514336],[-2.5919865277,51.4540585804],[-2.5919865277,51.4540585804],[-2.5919865277,51.4540585804],[-2.5912897864,51.4537005247],[-2.5909936492,51.4535652878]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.590644,51.452913],[-2.5914001125,51.453677419],[-2.5919530054,51.4540605372],[-2.5907855017,51.456392833],[-2.5907852801,51.4563934226],[-2.5907872634,51.4563953661],[-2.590873436,51.4564480051],[-2.5919725201,51.4577691835],[-2.5921378638,51.4577815765],[-2.5922209107,51.4577820413],[-2.5924801907,51.4576699711],[-2.5948629104,51.4568836406],[-2.5951569462,51.4567270609],[-2.5957527577,51.4562672112],[-2.5960330143,51.4557289501],[-2.5966455768,51.4550131653],[-2.5966456406,51.4550130907],[-2.5975542042,51.453951426],[-2.6047507649,51.4558322631],[-2.6094986387,51.4600227426],[-2.6130589366,51.4684099539],[-2.6138384449,51.468640508],[-2.6140236135,51.4689795221],[-2.6140803679,51.4696285311],[-2.616262984,51.475589749],[-2.6156672271,51.4789279029]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.6156672271,51.4789279029],[-2.6150823415,51.4793746553],[-2.6147663725,51.4793456254],[-2.6144117202,51.4793199708],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5888543164,51.4534751519],[-2.5889403216,51.4531747403],[-2.5909685009,51.4557092639],[-2.5908496794,51.4557166025],[-2.5913782463,51.4569286905],[-2.5898379007,51.4625025438],[-2.5900133952,51.4626665048],[-2.5899819658,51.462697947],[-2.5928627938,51.4687945239],[-2.5928877333,51.4687839293],[-2.5935871078,51.4697373936],[-2.5942610312,51.4703322848],[-2.6032351235,51.4764091118],[-2.6039343013,51.4768608411],[-2.6045754106,51.4772810989],[-2.611530842,51.4797978169],[-2.6125667717,51.4796674595],[-2.6128082964,51.4796047018],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.6131665559,51.4794909109],[-2.590644,51.452913]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.590644,51.452913],[-2.591598592,51.4540893574],[-2.5917204084,51.4545790644],[-2.5923327365,51.4581504667],[-2.5918217425,51.4584299486],[-2.5913411188,51.4589787397],[-2.5913121501,51.4592300825],[-2.5903459632,51.46518442],[-2.590685123,51.4660922971],[-2.5912122609,51.4671829664],[-2.5915970171,51.4678747927],[-2.5919103025,51.4681644361],[-2.5985610092,51.4735202302],[-2.5991742767,51.4740697611],[-2.600125087,51.4747837677],[-2.6081699945,51.4787888002],[-2.6091480358,51.4792049275],[-2.610230707,51.4795750442],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.6131665559,51.4794909109],[-2.6073381752,51.4785951356],[-2.6075255045,51.4785815498],[-2.604951122,51.4775485647],[-2.6022026282,51.4759062069],[-2.6000067787,51.4746789946],[-2.5987729203,51.4738208471],[-2.5978496697,51.4730528508],[-2.5965424392,51.4720302172],[-2.5951394007,51.4709502237],[-2.5943950412,51.4703898736],[-2.5943349601,51.470360441],[-2.5942027504,51.470330583],[-2.5935436165,51.469854516],[-2.5930190939,51.4690594702],[-2.5918245762,51.4680841324],[-2.5912768146,51.4672363426],[-2.590738417,51.4661871625],[-2.5905944638,51.4659422576],[-2.5905420023,51.4658913015],[-2.5899676169,51.4648069014],[-2.5895347276,51.4641111288],[-2.5896085233,51.4634702307],[-2.5898173598,51.4628522759],[-2.5902591459,51.4621305277],[-2.5908266987,51.461172104],[-2.5905361319,51.4600450894],[-2.5902659793,51.4597488433],[-2.5911494637,51.4589177613],[-2.5931244608,51.457492318],[-2.5932551695,51.4567057001],[-2.5921807129,51.4563078073],[-2.5920491885,51.4556411111],[-2.5919218883,51.4553640125],[-2.5922018436,51.4552134372],[-2.5922173274,51.4542832372],[-2.5917543055,51.4538567364],[-2.5917463261,51.4538516877],[-2.5906831142,51.4533703482],[-2.5887662398,51.4527590014]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5896151253,51.4525566542],[-2.5904900203,51.4528744889],[-2.5910778325,51.4534523598],[-2.5913228257,51.453520199],[-2.5915747431,51.4536837737],[-2.5918249809,51.4538007012],[-2.59188075,51.4537342056],[-2.5919378283,51.4531315678],[-2.5933098793,51.4520179021]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.590644,51.452913],[-2.5915425402,51.4536908487],[-2.5915524408,51.453696198],[-2.5924175043,51.4545158228],[-2.5926405219,51.4579795153],[-2.5925654525,51.4580029077],[-2.5912819407,51.458839505],[-2.5904785017,51.4656127063],[-2.5911603477,51.4670871688],[-2.5917062956,51.467958887],[-2.5997179597,51.4745509572],[-2.6008356185,51.4753797154],[-2.6019606333,51.4758258412],[-2.6081029476,51.47877932],[-2.6089588499,51.4791229222],[-2.6104549274,51.4796457077],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.6131665559,51.4794909109],[-2.6129537926,51.4793245022],[-2.6129369326,51.4791715336],[-2.6131967638,51.4790824481],[-2.6137975984,51.478994499],[-2.6139652029,51.4790550286]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.6139652029,51.4790550286],[-2.6157024774,51.4854317926],[-2.6166781635,51.4869923435],[-2.6182937676,51.4886965631],[-2.6211040817,51.4905905304],[-2.6219354201,51.4923947476],[-2.621944826,51.4923856162],[-2.6218955867,51.493893145],[-2.6213393747,51.4955923473],[-2.6211437127,51.4958846372],[-2.6202369041,51.4967264427],[-2.6217988817,51.4978648578],[-2.6243774025,51.5001594697],[-2.6252242778,51.5018985186],[-2.6269668116,51.5038750229],[-2.6280136727,51.5064148455],[-2.6300134865,51.5074300818],[-2.6313347396,51.5073279534],[-2.6327065051,51.5065626164],[-2.6342486389,51.5053503133]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.6342486389,51.5053503133],[-2.6363629637,51.5055873562],[-2.6360833769,51.5056870397],[-2.6356247245,51.5057679011],[-2.6356389322,51.50575824]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.6356389322,51.50575824],[-2.6370396087,51.5053406421],[-2.6379697616,51.5052012713],[-2.6310467167,51.5080280186],[-2.6309043861,51.5073657889],[-2.6287032643,51.5070752744],[-2.6279218218,51.5062506505],[-2.6221178659,51.4937194725],[-2.621917405,51.4932985521],[-2.621903666,51.4929309358],[-2.6213362094,51.4911019066],[-2.6131665559,51.4794909109]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.6131665559,51.4794909109],[-2.6130028342,51.4793645768],[-2.6113635648,51.4796660116],[-2.603218045,51.4930332947],[-2.6032176434,51.4930339538],[-2.6029973345,51.4933954939],[-2.6009667659,51.4949468958],[-2.5991642863,51.4960978477],[-2.5822281638,51.5063731382],[-2.580012151,51.5074364891],[-2.578026792,51.5086108195],[-2.577186906,51.5084537268],[-2.5797504332,51.5076634198]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5797504332,51.5076634198],[-2.579481845,51.5078087407],[-2.579283159,51.5079065002],[-2.5790518317,51.5079509096],[-2.5782737534,51.5074820937]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5782737534,51.5074820937],[-2.578638988,51.5081273476],[-2.579053292,51.5080696403],[-2.5794394251,51.5078776423],[-2.5795360502,51.507805349]]},"properties":{}}],[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[-2.5795360502,51.507805349],[-2.58694572,51.5037900403],[-2.5901131912,51.5023001758],[-2.5916815253,51.5014000995],[-2.6083932698,51.4888676874],[-2.6092772298,51.4874034068],[-2.6109337925,51.4857735059],[-2.6131665559,51.4794909109]]},"properties":{}}]]}


console.log(geoJSON4)


var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("#chart").append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("class", "svg-chart");
svg.selectAll("g")
    .data(tiler
      .scale(projection.scale() * 2 * Math.PI)
      .translate(projection([0, 0])))
  .enter().append("g")
    .each(function(d) {
      var g = d3.select(this);
      d3.json("http://" + ["a", "b", "c"][(d[0] * 31 + d[1]) % 3] + ".tile.openstreetmap.us/vectiles-highroad/" + d[2] + "/" + d[0] + "/" + d[1] + ".json", function(error, json) {
        g.selectAll("path")
            .data(json.features.sort(function(a, b) { return a.properties.sort_key - b.properties.sort_key; }))
          .enter().append("path")
            .attr("class", function(d) { return d.properties.kind; })
            .attr("d", path);
      });
    });

for (var i = 0; i < geoJSON.features.length; i++) {
  console.log('here')
svg.selectAll("path")
    .data(geoJSON4.features[i])
    .enter().append("path")
    .attr("d",path)
    .attr("stroke-opacity", 0.5)
    .attr("stroke-width", 1)  
}
})
